<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>StyloXio Admin Panel</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    :root {
      --primary: #2563eb;
      --primary-soft: #dbeafe;
      --dark: #020617;
      --gray-50: #f9fafb;
      --gray-100: #f3f4f6;
      --gray-200: #e5e7eb;
      --gray-700: #374151;
      --danger: #dc2626;
      --success: #16a34a;
    }

    * { box-sizing: border-box; margin: 0; padding: 0; }

    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: radial-gradient(circle at top left, #0f172a 0, #020617 40%, #020617 100%);
      color: #e5e7eb;
      min-height: 100vh;
    }

    .layout { min-height: 100vh; display: flex; flex-direction: column; }

    header {
      background: rgba(15, 23, 42, 0.9);
      backdrop-filter: blur(14px);
      border-bottom: 1px solid rgba(148, 163, 184, 0.3);
      padding: 0.75rem 1.2rem;
      display: flex; align-items: center; justify-content: space-between;
      position: sticky; top: 0; z-index: 20;
    }

    header .brand-title { font-size: 1rem; font-weight: 700; }
    header .brand-sub { font-size: 0.7rem; color: #9ca3af; }
    header .user-info { font-size: 0.75rem; color: #cbd5f5; }

    main { flex: 1; padding: 1.2rem 1rem 2rem; max-width: 1120px; margin: 0 auto; width: 100%; }

    .hidden { display: none !important; }

    .card {
      background: radial-gradient(circle at top left, #1f2937 0, #020617 70%);
      border-radius: 1rem;
      padding: 1rem;
      margin-bottom: 0.9rem;
      border: 1px solid rgba(148, 163, 184, 0.35);
      box-shadow: 0 18px 45px rgba(15, 23, 42, 0.9);
    }

    .btn { padding: 0.45rem 0.9rem; border-radius: 999px; cursor: pointer; }
    .btn-primary { background: linear-gradient(135deg, #2563eb, #7c3aed); color: #fff; }
    .btn-outline { border: 1px solid rgba(148,163,184,0.8); color: #e5e7eb; }
    .btn-danger { background: linear-gradient(135deg,#dc2626,#b91c1c); color: #fff; }

    input,textarea {
      width: 100%; padding: 0.5rem; border-radius: 0.5rem;
      border: 1px solid rgba(148,163,184,0.7);
      background: rgba(15,23,42,0.8); color: #fff;
    }
  </style>
</head>

<body>
  <div class="layout">
    <header>
      <div class="brand">
        <div class="brand-title">StyloXio Admin</div>
        <div class="brand-sub">Control panel for products & orders</div>
      </div>
      <div class="user-info" id="adminUserInfo">Not logged in</div>
    </header>

    <main>
      <!-- LOGIN -->
      <section id="loginSection" class="login-wrapper" style="max-width:420px;margin:3rem auto;">
        <div class="card">
          <h3>Admin Login</h3>
          <p>Use email & password</p>

          <label>Email</label>
          <input type="email" id="loginEmail" placeholder="admin@styloxio.com" />

          <label>Password</label>
          <input type="password" id="loginPassword" placeholder="••••••••" />

          <br />
          <button class="btn btn-primary" id="loginBtn">Login</button>
          <button class="btn btn-outline" id="registerBtn">Create first admin</button>
          <p id="loginStatus"></p>
        </div>
      </section>

      <!-- ADMIN DASHBOARD -->
      <section id="adminSection" class="hidden">
        <div class="card">
          <h2>Products</h2>
          <form id="productForm">
            <input type="hidden" id="productId">
            <label>Name</label><input id="productName" required>
            <label>Price</label><input type="number" id="productPrice" required>
            <label>Stock</label><input type="number" id="productStock" required>
            <label>Category</label><input id="productCategory" required>
            <label>Image URL</label><input id="productImage">
            <label>Description</label><textarea id="productDescription"></textarea>

            <button class="btn btn-primary" type="submit">Save Product</button>
            <button class="btn btn-outline" type="button" id="clearProductForm">Clear</button>
          </form>

          <br><br>
          <table border="1" width="100%">
            <thead><tr><th>Name</th><th>Category</th><th>Price</th><th>Stock</th><th>Action</th></tr></thead>
            <tbody id="productsTableBody">
              <tr><td colspan="5">Loading...</td></tr>
            </tbody>
          </table>
        </div>

        <button class="btn btn-danger" id="logoutBtn">Logout</button>
      </section>
    </main>
  </div>

  <!-- FIREBASE SDK -->
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>

  <!-- YOUR FIREBASE CONFIG -->
  <script src="firebase-config.js"></script>

  <!-- IMPORTANT: INITIALIZE FIRESTORE -->
  <script>
    const auth = firebase.auth();
    const db = firebase.firestore();
  </script>

  <!-- ADMIN JAVASCRIPT -->
  <script>
    const $ = (id) => document.getElementById(id);

    const loginSection = $("loginSection");
    const adminSection = $("adminSection");
    const loginStatus = $("loginStatus");
    const adminUserInfo = $("adminUserInfo");

    auth.onAuthStateChanged((user) => {
      if (user) {
        loginSection.classList.add("hidden");
        adminSection.classList.remove("hidden");
        adminUserInfo.textContent = "Logged in as " + user.email;
        loadProducts();
      } else {
        loginSection.classList.remove("hidden");
        adminSection.classList.add("hidden");
        adminUserInfo.textContent = "Not logged in";
      }
    });

    $("loginBtn").onclick = async () => {
      loginStatus.textContent = "Logging in...";
      try {
        await auth.signInWithEmailAndPassword($("loginEmail").value, $("loginPassword").value);
        loginStatus.textContent = "Success ✔";
      } catch (e) { loginStatus.textContent = e.message; }
    };

    $("registerBtn").onclick = async () => {
      loginStatus.textContent = "Creating admin...";
      try {
        await auth.createUserWithEmailAndPassword($("loginEmail").value, $("loginPassword").value);
        loginStatus.textContent = "Admin Created ✔";
      } catch (e) { loginStatus.textContent = e.message; }
    };

    $("logoutBtn").onclick = () => auth.signOut();

    async function loadProducts() {
      const body = $("productsTableBody");
      body.innerHTML = "<tr><td colspan='5'>Loading...</td></tr>";
      const snap = await db.collection("products").get();
      if (snap.empty) return body.innerHTML = "<tr><td colspan='5'>No products</td></tr>";

      body.innerHTML = "";
      snap.forEach((doc) => {
        const p = doc.data();
        body.innerHTML += `
          <tr>
            <td>${p.name}</td>
            <td>${p.category}</td>
            <td>${p.price}</td>
            <td>${p.stock}</td>
            <td>
              <button onclick="deleteProduct('${doc.id}')">Delete</button>
            </td>
          </tr>`;
      });
    }

    async function deleteProduct(id) {
      if(confirm("Delete this product?")) {
        await db.collection("products").doc(id).delete();
        loadProducts();
      }
    }

    $("productForm").onsubmit = async (e) => {
      e.preventDefault();
      const data = {
        name: $("productName").value,
        category: $("productCategory").value,
        price: Number($("productPrice").value),
        stock: Number($("productStock").value),
        imageUrl: $("productImage").value,
        description: $("productDescription").value,
        createdAt: firebase.firestore.FieldValue.serverTimestamp(),
      };
      await db.collection("products").add(data);
      loadProducts();
      $("productForm").reset();
    };
  </script>
</body>
</html>
