<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>StyloXio Admin Dashboard</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    body { margin:0; font-family: 'Segoe UI', sans-serif; background:#0f172a; color:#e2e8f0; }
    header { padding:18px 26px; background:#1e293b; border-bottom:1px solid #334155; display:flex; justify-content:space-between; align-items:center; }
    h1 { font-size:22px; font-weight:700; }
    .logout { padding:8px 15px; background:#ef4444; border:none; border-radius:6px; color:white; cursor:pointer; }

    .grid { display:grid; gap:18px; padding:20px; }
    .grid-4 { grid-template-columns:repeat(4,1fr); }
    .card { padding:18px; border-radius:12px; background:#1e293b; border:1px solid #475569; }
    .card-title { font-size:14px; opacity:0.9; }
    .big { font-size:26px; margin-top:8px; font-weight:bold; }

    .section-title { margin:25px 20px 8px; font-size:20px; font-weight:600; }

    table { width:100%; border-collapse:collapse; margin-top:10px; }
    th, td { padding:10px 12px; border-bottom:1px solid #334155; }
    th { text-transform:uppercase; font-size:12px; opacity:0.7; background:#0f172a; }
    tr:hover td { background:#182335; }

    input, textarea { width:100%; padding:10px; margin-top:6px; border-radius:6px; background:#0f172a; border:1px solid #475569; color:white; }
    button { margin-top:10px; padding:10px 16px; border:none; border-radius:6px; cursor:pointer; }
    .btn-primary { background:#2563eb; color:white; }
    .btn-danger { background:#cc0000; color:white; }
  </style>
</head>
<body>

<header>
  <h1>StyloXio Admin Dashboard</h1>
  <button class="logout" id="logoutBtn">Logout</button>
</header>

<!-- STATS -->
<div class="grid grid-4">
  <div class="card">
    <div class="card-title">Total Products</div>
    <div class="big" id="statProducts">0</div>
  </div>
  <div class="card">
    <div class="card-title">Total Orders</div>
    <div class="big" id="statOrders">0</div>
  </div>
  <div class="card">
    <div class="card-title">Pending Orders</div>
    <div class="big" id="statPending">0</div>
  </div>
  <div class="card">
    <div class="card-title">Revenue (₹)</div>
    <div class="big" id="statRevenue">0</div>
  </div>
</div>

<!-- PRODUCT FORM -->
<h2 class="section-title">Add / Edit Product</h2>
<div class="card" style="margin:20px;">
  <input type="hidden" id="productId">
  <label>Name</label>
  <input id="productName" placeholder="Black Hoodie">

  <label>Price (₹)</label>
  <input type="number" id="productPrice">

  <label>Stock</label>
  <input type="number" id="productStock">

  <label>Category</label>
  <input id="productCategory" placeholder="Shoes / Hoodies / Watch">

  <label>Image URL</label>
  <input id="productImage">

  <label>Description</label>
  <textarea id="productDescription"></textarea>

  <button class="btn-primary" onclick="saveProduct()">Save Product</button>
  <button class="btn-danger" onclick="clearForm()">Clear</button>
</div>

<!-- PRODUCT TABLE -->
<h2 class="section-title">Products</h2>
<div class="card" style="margin:20px;">
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Category</th>
        <th>Price</th>
        <th>Stock</th>
        <th>Action</th>
      </tr>
    </thead>
    <tbody id="productsTable">Loading...</tbody>
  </table>
</div>

<!-- ORDERS -->
<h2 class="section-title">Orders</h2>
<div class="card" style="margin:20px;">
  <table>
    <thead>
      <tr>
        <th>ID</th>
        <th>Customer</th>
        <th>Total</th>
        <th>Status</th>
        <th>Date</th>
      </tr>
    </thead>
    <tbody id="ordersTable">Loading...</tbody>
  </table>
</div>

<!-- FIREBASE -->
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
<script src="firebase-config.js"></script>

<script>
  const auth = firebase.auth();
  const db = firebase.firestore();

  auth.onAuthStateChanged(user => {
    if (!user) window.location.href = "admin.html";
  });

  document.getElementById("logoutBtn").onclick = () => auth.signOut();

  const productsRef = () => db.collection("products");
  const ordersRef = () => db.collection("orders");

  async function saveProduct(){
    let id = document.getElementById("productId").value;
    let data = {
      name: productName.value,
      price: Number(productPrice.value),
      stock: Number(productStock.value),
      category: productCategory.value,
      image: productImage.value,
      description: productDescription.value,
      updatedAt: firebase.firestore.FieldValue.serverTimestamp()
    };
    if(id) await productsRef().doc(id).set(data,{merge:true});
    else await productsRef().add({...data,createdAt:firebase.firestore.FieldValue.serverTimestamp()});
    loadProducts();
    clearForm();
  }

  function clearForm(){
    productId.value="";
    productName.value="";
    productPrice.value="";
    productStock.value="";
    productCategory.value="";
    productImage.value="";
    productDescription.value="";
  }

  async function loadProducts(){
    const snap = await productsRef().orderBy("createdAt","desc").get();
    let html="";
    snap.forEach(doc=>{
      let d = doc.data();
      html += `
        <tr>
          <td>${d.name}</td>
          <td>${d.category}</td>
          <td>₹${d.price}</td>
          <td>${d.stock}</td>
          <td>
            <button onclick="editProduct('${doc.id}')">Edit</button>
            <button onclick="deleteProduct('${doc.id}')" class="btn-danger">Delete</button>
          </td>
        </tr>`;
    });
    productsTable.innerHTML = html;
    loadStats();
  }

  async function editProduct(id){
    const d = (await productsRef().doc(id).get()).data();
    productId.value=id;
    productName.value=d.name;
    productPrice.value=d.price;
    productStock.value=d.stock;
    productCategory.value=d.category;
    productImage.value=d.image;
    productDescription.value=d.description;
    window.scrollTo(0,0);
  }

  async function deleteProduct(id){
    if(confirm("Delete Product?")) await productsRef().doc(id).delete();
    loadProducts();
  }

  async function loadStats(){
    statProducts.innerText = (await productsRef().get()).size;
    const snap = await ordersRef().get();
    statOrders.innerText = snap.size;
    let pending=0,rev=0;
    snap.forEach(o=>{
      let d=o.data();
      if(d.status=="pending") pending++;
      if(d.status=="completed") rev += Number(d.total||0);
    });
    statPending.innerText=pending;
    statRevenue.innerText=rev;
  }

  async function loadOrders(){
    const snap = await ordersRef().orderBy("createdAt","desc").get();
    let html="";
    snap.forEach(doc=>{
      let d=doc.data();
      html+=`
        <tr>
          <td>${doc.id}</td>
          <td>${d.customerName||""}</td>
          <td>₹${d.total||0}</td>
          <td>${d.status||"pending"}</td>
          <td>${d.createdAt?.toDate().toLocaleString()||""}</td>
        </tr>`;
    });
    ordersTable.innerHTML = html;
  }

  loadProducts();
  loadOrders();
</script>

</body>
</html>
